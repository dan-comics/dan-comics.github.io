<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Counter Test - Dan Comics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #333;
            border-radius: 10px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
        }
        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Counter API Test Page</h1>
    <p>This page tests if the global view counter API is working correctly.</p>

    <div class="test-box">
        <h2>Test 1: Hit Counter (Increment)</h2>
        <p>Click the button to increment the test counter.</p>
        <button onclick="testHit()">Increment Counter</button>
        <div id="hit-result"></div>
    </div>

    <div class="test-box">
        <h2>Test 2: Get Counter (Read)</h2>
        <p>Click to read the current counter value without incrementing.</p>
        <button onclick="testGet()">Get Counter</button>
        <div id="get-result"></div>
    </div>

    <div class="test-box">
        <h2>Test 3: Comic Counter (Real Example)</h2>
        <p>Test with an actual comic key like the website uses.</p>
        <button onclick="testComic()">Test Comic Counter</button>
        <div id="comic-result"></div>
    </div>

    <div class="test-box">
        <h2>Instructions:</h2>
        <ol>
            <li>Click "Increment Counter" multiple times</li>
            <li>Click "Get Counter" to verify the value persists</li>
            <li>Refresh this page</li>
            <li>Click "Get Counter" again - the value should NOT reset to 0</li>
            <li>Open this page in another browser/device and check if the counter is the same</li>
        </ol>
    </div>

    <script>
        const COUNTER_NAMESPACE = 'dancomics-evan-sd';
        const COUNTER_API = 'https://api.countapi.xyz';

        function showResult(elementId, success, message, data) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="result ${success ? '' : 'error'}">
                    <strong>${success ? '‚úÖ Success' : '‚ùå Error'}</strong><br>
                    ${message}
                    ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
                </div>
            `;
        }

        async function testHit() {
            const key = 'test-counter';
            const url = `${COUNTER_API}/hit/${COUNTER_NAMESPACE}/${key}`;

            try {
                console.log('Calling:', url);
                const response = await fetch(url);
                const data = await response.json();

                console.log('Response:', data);

                if (response.ok && data.value !== undefined) {
                    showResult('hit-result', true,
                        `Counter incremented successfully! New value: ${data.value}`,
                        data);
                } else {
                    showResult('hit-result', false,
                        'Failed to increment counter',
                        data);
                }
            } catch (error) {
                showResult('hit-result', false,
                    `Error: ${error.message}`,
                    { error: error.toString() });
            }
        }

        async function testGet() {
            const key = 'test-counter';
            const url = `${COUNTER_API}/get/${COUNTER_NAMESPACE}/${key}`;

            try {
                console.log('Calling:', url);
                const response = await fetch(url);
                const data = await response.json();

                console.log('Response:', data);

                if (response.ok && data.value !== undefined) {
                    showResult('get-result', true,
                        `Current counter value: ${data.value}`,
                        data);
                } else {
                    showResult('get-result', false,
                        'Counter does not exist yet. Click "Increment Counter" first.',
                        data);
                }
            } catch (error) {
                showResult('get-result', false,
                    `Error: ${error.message}`,
                    { error: error.toString() });
            }
        }

        async function testComic() {
            const series = 'Original Dan';
            const title = '1st Dan Comic ever';
            const key = `${series}-${title}`
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');

            const hitUrl = `${COUNTER_API}/hit/${COUNTER_NAMESPACE}/${key}`;

            try {
                console.log('Testing comic counter with key:', key);
                console.log('URL:', hitUrl);

                const response = await fetch(hitUrl);
                const data = await response.json();

                console.log('Response:', data);

                if (response.ok && data.value !== undefined) {
                    showResult('comic-result', true,
                        `Comic counter incremented! Value: ${data.value}<br>Key: ${key}`,
                        data);
                } else {
                    showResult('comic-result', false,
                        'Failed to increment comic counter',
                        data);
                }
            } catch (error) {
                showResult('comic-result', false,
                    `Error: ${error.message}`,
                    { error: error.toString() });
            }
        }

        // Auto-test on load
        window.onload = () => {
            console.log('Counter API Base:', COUNTER_API);
            console.log('Namespace:', COUNTER_NAMESPACE);
        };
    </script>
</body>
</html>
