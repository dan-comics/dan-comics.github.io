<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dan Comics - By Evan</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Neue', 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: url('Website/Webbackground.jpg') center center;
            background-size: cover;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            min-height: 200px;
        }

        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.1);
            z-index: 0;
        }

        .header h1 {
            font-family: 'Bangers', cursive;
            font-size: 4em;
            color: #fff;
            text-shadow: 4px 4px 0 #000,
                         6px 6px 10px rgba(0,0,0,0.8),
                         -2px -2px 0 #FF1493,
                         2px -2px 0 #00CED1,
                         -2px 2px 0 #FFD700;
            letter-spacing: 3px;
            position: relative;
            z-index: 1;
            animation: bounce 2s infinite;
        }

        .subtitle {
            font-size: 1.5em;
            color: #fff;
            margin-top: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8),
                         0 0 10px rgba(0,0,0,0.6);
            position: relative;
            z-index: 1;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .nav-breadcrumb {
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            text-align: center;
            font-size: 1.1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .nav-breadcrumb button {
            background: #FF6347;
            color: white;
            border: 3px solid #000;
            padding: 10px 20px;
            font-family: 'Bangers', cursive;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.2s;
        }

        .nav-breadcrumb button:hover {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #000;
        }

        /* Sub-tabs */
        .sub-tab-container {
            background: rgba(255,255,255,0.9);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            padding: 15px 20px;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .sub-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .sub-tab-button {
            padding: 12px 25px;
            border: 3px solid #000;
            background: #FFD700;
            cursor: pointer;
            font-family: 'Comic Neue', cursive;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 10px;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .sub-tab-button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 #000;
        }

        .sub-tab-button.active {
            background: #FF6347;
            color: white;
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #000;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .series-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 40px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .series-card {
            background: white;
            border: 4px solid #000;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
            position: relative;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .series-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 7px 7px 0 rgba(0,0,0,0.4);
        }

        .series-card:active {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0 rgba(0,0,0,0.3);
        }

        .series-button-content {
            text-align: center;
            width: 100%;
        }

        .series-card .series-icon {
            font-size: 50px;
            display: block;
            margin-bottom: 10px;
        }

        .series-card h3 {
            font-family: 'Bangers', cursive;
            font-size: 1.5em;
            color: #333;
            text-shadow: 2px 2px 0 rgba(255,215,0,0.5);
            margin: 0;
        }

        .comics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .comic-card {
            background: white;
            border: 5px solid #000;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.3);
            position: relative;
        }

        .comic-card:hover {
            transform: translate(-4px, -4px) rotate(-2deg);
            box-shadow: 12px 12px 0 rgba(0,0,0,0.4);
        }

        .comic-card img {
            width: 100%;
            height: 350px;
            object-fit: cover;
            display: block;
            border-bottom: 3px solid #000;
        }

        .comic-card .pdf-preview {
            width: 100%;
            height: 350px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 3px solid #000;
            flex-direction: column;
            gap: 10px;
        }

        .comic-card .pdf-preview .pdf-icon {
            font-size: 80px;
        }

        .comic-card .pdf-preview .pdf-text {
            font-family: 'Bangers', cursive;
            font-size: 1.3em;
            color: #666;
        }

        .comic-title {
            padding: 15px;
            background: #FFE082;
            font-weight: bold;
            text-align: center;
            color: #333;
            font-size: 1.1em;
        }

        .about-section {
            background: white;
            border: 5px solid #000;
            border-radius: 15px;
            padding: 40px;
            margin: 40px auto;
            max-width: 800px;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.3);
        }

        .about-section h2 {
            font-family: 'Bangers', cursive;
            font-size: 2.5em;
            color: #FF6347;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #FFD700;
        }

        .about-section p {
            font-size: 1.3em;
            line-height: 1.8;
            color: #333;
            text-align: center;
        }

        .footer {
            background: #333;
            color: #FFD700;
            text-align: center;
            padding: 30px 20px;
            font-size: 1.2em;
            font-family: 'Bangers', cursive;
            letter-spacing: 2px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.3);
        }

        /* Lightbox Styles */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            animation: zoomIn 0.3s;
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .lightbox img {
            max-width: 100%;
            max-height: 90vh;
            border: 5px solid #FFD700;
            box-shadow: 0 0 50px rgba(255,215,0,0.5);
        }

        .lightbox iframe,
        .lightbox embed {
            width: 90vw;
            height: 90vh;
            border: 5px solid #FFD700;
            box-shadow: 0 0 50px rgba(255,215,0,0.5);
            background: white;
        }

        .lightbox-close {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #FF6347;
            color: white;
            border: 3px solid #000;
            padding: 10px 20px;
            font-family: 'Bangers', cursive;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 3px 3px 0 #000;
            z-index: 1001;
        }

        .lightbox-nav {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,215,0,0.9);
            border: 3px solid #000;
            padding: 15px 12px;
            font-size: 1.8em;
            cursor: pointer;
            border-radius: 50%;
            font-family: 'Bangers', cursive;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.2s;
            z-index: 1001;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-nav:hover {
            background: #FFD700;
            transform: translateY(-50%) scale(1.15);
        }

        .lightbox-prev {
            left: 20px;
        }

        .lightbox-next {
            right: 20px;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 2em;
            color: white;
            font-family: 'Bangers', cursive;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            margin: 20px;
        }

        .empty-message {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.8em;
            color: white;
            font-family: 'Bangers', cursive;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            margin: 20px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                padding: 30px 15px;
            }

            .comics-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 20px;
            }

            .comic-card img {
                height: 300px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }

            .subtitle {
                font-size: 1.2em;
            }

            .series-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 0 10px;
            }

            .series-card {
                min-height: 100px;
                padding: 15px;
            }

            .series-card .series-icon {
                font-size: 40px;
                margin-bottom: 8px;
            }

            .series-card h3 {
                font-size: 1.3em;
            }

            .sub-tab-button {
                padding: 10px 20px;
                font-size: 1em;
            }

            .comics-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .comic-card img,
            .comic-card .pdf-preview {
                height: auto;
                min-height: 250px;
            }

            .about-section {
                padding: 25px;
                margin: 30px 10px;
            }

            .about-section h2 {
                font-size: 2em;
            }

            .about-section p {
                font-size: 1.1em;
            }

            .lightbox-close {
                top: 10px;
                right: 10px;
                font-size: 1.2em;
                padding: 8px 15px;
            }

            .lightbox-nav {
                padding: 10px 8px;
                font-size: 1.4em;
                width: 45px;
                height: 45px;
            }

            .lightbox-prev {
                left: 10px;
            }

            .lightbox-next {
                right: 10px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 2em;
                letter-spacing: 1px;
            }

            .subtitle {
                font-size: 1em;
            }

            .series-card h3 {
                font-size: 1.1em;
            }

            .series-card .series-icon {
                font-size: 35px;
            }

            .nav-breadcrumb button {
                padding: 8px 15px;
                font-size: 1em;
            }

            .lightbox-content {
                max-width: 95%;
            }

            .footer {
                font-size: 1em;
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 id="headerTitle">DAN COMICS</h1>
        <div class="subtitle" id="headerSubtitle">Created by Evan from San Diego</div>
    </div>

    <div class="nav-breadcrumb hidden" id="breadcrumb">
        <button onclick="goBack()">‚Üê Back to Series</button>
    </div>

    <div class="sub-tab-container hidden" id="subTabContainer">
        <div class="sub-tabs" id="subTabs">
            <!-- Sub-tabs will be loaded here -->
        </div>
    </div>

    <div class="container" id="mainContent">
        <div id="seriesView" class="series-grid">
            <!-- Series will be loaded here -->
        </div>

        <div id="comicsView" class="hidden">
            <div class="comics-grid" id="comicsList">
                <!-- Comics will be loaded here -->
            </div>
        </div>

        <div class="about-section" id="aboutSection">
            <h2 id="aboutTitle">About Evan</h2>
            <p id="aboutText">
                Meet Evan, an 11-year-old comic artist from San Diego, California!
                Evan creates hilarious and imaginative adventures featuring Dan and friends.
                From epic battles to everyday funnies, each comic is bursting with creativity and humor.
                Dive into the wild world of The Dan Comics and discover what happens when imagination knows no bounds!
            </p>
        </div>
    </div>

    <div class="footer">
        Created in San Diego, CA ‚òÄÔ∏è<br>
        ¬© 2026 Dan (creator of Dan Comic). All rights reserved.
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">‚úï Close</button>
        <button class="lightbox-nav lightbox-prev" onclick="navigateComic(-1)">‚Üê</button>
        <button class="lightbox-nav lightbox-next" onclick="navigateComic(1)">‚Üí</button>
        <div class="lightbox-content" id="lightboxContent">
            <img id="lightboxImg" src="" alt="Comic" class="hidden">
            <iframe id="lightboxPdf" src="" class="hidden"></iframe>
        </div>
    </div>

    <script>
        // Comic series data structure
        let comicSeries = [];
        let currentComics = [];
        let currentComicIndex = 0;
        let currentSeries = null;
        let currentSubFolder = null;

        // GitHub repository information
        const GITHUB_REPO_OWNER = 'dan-comics';
        const GITHUB_REPO_NAME = 'dan-comics.github.io';
        const GITHUB_API_BASE = 'https://api.github.com';

        // Series configuration with icons and colors
        const seriesConfig = {
            'Origional Dan': { icon: '‚≠ê', color: '#FF6B6B' },
            'Dan Funnies': { icon: 'üòÇ', color: '#4ECDC4' },
            'Cheez Dame': { icon: 'üßÄ', color: '#FFD93D' },
            'Dan Music': { icon: 'üéµ', color: '#95E1D3' },
            'Dan Ice cream': { icon: 'üç¶', color: '#F38181' },
            'Dan Shorts': { icon: 'üé¨', color: '#AA96DA' },
            'Dan Science': { icon: 'üî¨', color: '#FCBAD3' },
            'Dan Character': { icon: 'üë•', color: '#FFA07A' },
            'FLL - Band of Bots': { icon: 'ü§ñ', color: '#5C6BC0' },
            'More Series Here': { icon: '‚ú®', color: '#A8E6CF' }
        };

        // Initialize the page
        async function init() {
            await loadSeriesFromGitHub();
            loadSeries();

            // Handle initial URL
            handleRouteChange();

            // Handle browser back/forward buttons
            window.addEventListener('hashchange', handleRouteChange);
        }

        // Convert series/folder name to URL slug
        function nameToSlug(name) {
            return name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
        }

        // Convert URL slug back to name
        function slugToName(slug) {
            const series = comicSeries.find(s => nameToSlug(s.name) === slug);
            return series ? series.name : null;
        }

        // Handle route changes from URL
        async function handleRouteChange() {
            const hash = window.location.hash.slice(1); // Remove #
            if (!hash || hash === '/') {
                // Home page - show series grid
                if (currentSeries) {
                    goBack();
                }
                return;
            }

            const parts = hash.split('/').filter(p => p); // Split by / and remove empty
            if (parts.length === 0) return;

            const seriesSlug = parts[0];
            const subFolderSlug = parts[1];

            // Find the series
            const series = comicSeries.find(s => nameToSlug(s.name) === seriesSlug);
            if (!series) {
                console.error('Series not found:', seriesSlug);
                return;
            }

            // Open the series
            await openSeriesFromRoute(series, subFolderSlug);
        }

        // Open series from route (without triggering URL update)
        async function openSeriesFromRoute(series, subFolderSlug = null) {
            currentSeries = series;

            document.getElementById('seriesView').classList.add('hidden');
            document.getElementById('comicsView').classList.remove('hidden');
            document.getElementById('breadcrumb').classList.remove('hidden');

            // Update header and about section for Band of Bots
            if (series.name === 'FLL - Band of Bots') {
                document.getElementById('headerTitle').textContent = 'BAND OF BOTS';
                document.getElementById('headerSubtitle').textContent = 'FLL Team 71484 - Where Music Meets Robotics';
                document.getElementById('aboutTitle').textContent = 'About Band of Bots';
                document.getElementById('aboutText').innerHTML = `
                    Meet the Band of Bots, FLL Team 71484! We're a group of talented 5th graders from San Diego who share two passions:
                    creating music together as a band and building amazing robots. Whether we're jamming on our instruments or
                    engineering innovative solutions, we work as a team, support each other, and have a blast doing it.
                    From robotics competitions to rock concerts, we're always learning, creating, and rocking out together!
                `;
            } else {
                // Reset to default Dan Comics branding
                document.getElementById('headerTitle').textContent = 'DAN COMICS';
                document.getElementById('headerSubtitle').textContent = 'Created by Evan from San Diego';
                document.getElementById('aboutTitle').textContent = 'About Evan';
                document.getElementById('aboutText').innerHTML = `
                    Meet Evan, an 11-year-old comic artist from San Diego, California!
                    Evan creates hilarious and imaginative adventures featuring Dan and friends.
                    From epic battles to everyday funnies, each comic is bursting with creativity and humor.
                    Dive into the wild world of The Dan Comics and discover what happens when imagination knows no bounds!
                `;
            }

            // Show/hide sub-tabs
            const subTabContainer = document.getElementById('subTabContainer');
            if (series.subFolders && series.subFolders.length > 0) {
                renderSubTabs(series.subFolders);
                subTabContainer.classList.remove('hidden');

                // Load specific subfolder or first one
                let subFolder = series.subFolders[0];
                if (subFolderSlug) {
                    const found = series.subFolders.find(sf => nameToSlug(sf.name) === subFolderSlug);
                    if (found) subFolder = found;
                }
                await loadSubFolderFromRoute(subFolder);
            } else {
                subTabContainer.classList.add('hidden');
                await loadComics(series.folder);
            }
        }

        // Load series folders dynamically from GitHub
        async function loadSeriesFromGitHub() {
            try {
                const url = `${GITHUB_API_BASE}/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/Website`;
                const response = await fetch(url);

                if (!response.ok) {
                    console.error('Failed to load from GitHub, using fallback');
                    loadFallbackSeries();
                    return;
                }

                const items = await response.json();
                const folders = items.filter(item => item.type === 'dir');

                // Create series array from discovered folders
                comicSeries = await Promise.all(folders.map(async folder => {
                    const folderName = folder.name;
                    const config = seriesConfig[folderName] || {
                        icon: 'üìö',
                        color: getRandomColor()
                    };

                    // Check for subfolders
                    const subFolders = await getSubFolders(folderName);

                    return {
                        name: folderName,
                        folder: folderName,
                        color: config.color,
                        icon: config.icon,
                        subFolders: subFolders
                    };
                }));

                console.log('Loaded series from GitHub:', comicSeries);
            } catch (error) {
                console.error('Error loading series from GitHub:', error);
                loadFallbackSeries();
            }
        }

        // Get subfolders for a series
        async function getSubFolders(seriesFolder) {
            try {
                const encodedFolder = encodeURIComponent(seriesFolder);
                const url = `${GITHUB_API_BASE}/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/Website/${encodedFolder}`;
                const response = await fetch(url);

                if (!response.ok) return [];

                const items = await response.json();
                const folders = items.filter(item => item.type === 'dir');

                let subFolders = folders.map(folder => ({
                    name: folder.name,
                    path: `${seriesFolder}/${folder.name}`
                }));

                // Custom ordering for Band of Bots
                if (seriesFolder === 'FLL - Band of Bots') {
                    const orderMap = {
                        'Team Fun': 1,
                        'The Airlock IP': 2,
                        'The Band': 3,
                        'Dan Comics - Band of Bots': 4
                    };
                    subFolders.sort((a, b) => {
                        const orderA = orderMap[a.name] || 999;
                        const orderB = orderMap[b.name] || 999;
                        return orderA - orderB;
                    });
                }

                return subFolders;
            } catch (error) {
                console.error('Error loading subfolders:', error);
                return [];
            }
        }

        // Fallback series if GitHub API fails
        function loadFallbackSeries() {
            comicSeries = [
                { name: "Origional Dan", folder: "Origional Dan", color: "#FF6B6B", icon: "‚≠ê", subFolders: [] },
                { name: "Dan Funnies", folder: "Dan Funnies", color: "#4ECDC4", icon: "üòÇ", subFolders: [] },
                { name: "Cheez Dame", folder: "Cheez Dame", color: "#FFD93D", icon: "üßÄ", subFolders: [] },
                { name: "Dan Music", folder: "Dan Music", color: "#95E1D3", icon: "üéµ", subFolders: [] },
                { name: "Dan Ice cream", folder: "Dan Ice cream", color: "#F38181", icon: "üç¶", subFolders: [] },
                { name: "Dan Shorts", folder: "Dan Shorts", color: "#AA96DA", icon: "üé¨", subFolders: [] },
                { name: "Dan Science", folder: "Dan Science", color: "#FCBAD3", icon: "üî¨", subFolders: [] },
                { name: "Dan Character", folder: "Dan Character", color: "#FFA07A", icon: "üë•", subFolders: [] },
                { name: "FLL - Band of Bots", folder: "FLL - Band of Bots", color: "#5C6BC0", icon: "ü§ñ", subFolders: [
                    { name: "Team Fun", path: "FLL - Band of Bots/Team Fun" },
                    { name: "The Airlock IP", path: "FLL - Band of Bots/The Airlock IP" },
                    { name: "The Band", path: "FLL - Band of Bots/The Band" },
                    { name: "Dan Comics - Band of Bots", path: "FLL - Band of Bots/Dan Comics - Band of Bots" }
                ]},
                { name: "More Series Here", folder: "More Series Here", color: "#A8E6CF", icon: "‚ú®", subFolders: [] }
            ];
        }

        // Generate a random color for new series
        function getRandomColor() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#95E1D3', '#F38181', '#AA96DA', '#FCBAD3', '#A8E6CF'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Load all series as cards
        function loadSeries() {
            const seriesView = document.getElementById('seriesView');
            seriesView.innerHTML = '';

            comicSeries.forEach((series, index) => {
                const card = document.createElement('div');
                card.className = 'series-card';
                card.style.background = series.color;
                card.onclick = () => openSeries(series);

                card.innerHTML = `
                    <div class="series-button-content">
                        <span class="series-icon">${series.icon}</span>
                        <h3>${series.name}</h3>
                    </div>
                `;

                seriesView.appendChild(card);
            });
        }

        // Open a series
        async function openSeries(series) {
            // Update URL
            window.location.hash = `#/${nameToSlug(series.name)}`;
        }

        // Load a subfolder from route (without triggering URL update)
        async function loadSubFolderFromRoute(subFolder) {
            currentSubFolder = subFolder;

            // Update active sub-tab
            document.querySelectorAll('.sub-tab-button').forEach((btn, index) => {
                btn.classList.remove('active');
                if (currentSeries.subFolders[index] === subFolder) {
                    btn.classList.add('active');
                }
            });

            // Load comics from subfolder
            await loadComics(subFolder.path);
        }

        // Render sub-tabs
        function renderSubTabs(subFolders) {
            const subTabs = document.getElementById('subTabs');
            subTabs.innerHTML = '';

            subFolders.forEach((subFolder, index) => {
                const tab = document.createElement('button');
                tab.className = 'sub-tab-button';
                if (index === 0) tab.classList.add('active');
                tab.textContent = subFolder.name;
                tab.onclick = () => loadSubFolder(subFolder);

                subTabs.appendChild(tab);
            });
        }

        // Load a subfolder
        async function loadSubFolder(subFolder, skipUpdate = false) {
            currentSubFolder = subFolder;

            if (!skipUpdate) {
                // Update URL
                window.location.hash = `#/${nameToSlug(currentSeries.name)}/${nameToSlug(subFolder.name)}`;
            }
        }

        // Load comics for a folder path
        async function loadComics(folderPath) {
            const comicsList = document.getElementById('comicsList');
            comicsList.innerHTML = '<div class="loading">Loading comics...</div>';

            const comics = await getComicsForFolder(folderPath);
            currentComics = comics;

            comicsList.innerHTML = '';

            if (comics.length === 0) {
                comicsList.innerHTML = '<div class="empty-message">No comics found in this folder yet!</div>';
                return;
            }

            comics.forEach((comic, index) => {
                const card = document.createElement('div');
                card.className = 'comic-card';
                card.onclick = () => openLightbox(index);

                if (comic.isPdf) {
                    // PDF preview
                    const pdfPreview = document.createElement('div');
                    pdfPreview.className = 'pdf-preview';
                    const pdfMessage = isMobileDevice() ? 'Click to open PDF' : 'Click to view PDF';
                    pdfPreview.innerHTML = `
                        <div class="pdf-icon">üìÑ</div>
                        <div class="pdf-text">${pdfMessage}</div>
                    `;
                    card.appendChild(pdfPreview);
                } else {
                    // Image preview
                    const img = document.createElement('img');
                    img.src = comic.path;
                    img.alt = comic.title;
                    img.loading = 'lazy';
                    img.onerror = function() {
                        this.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="350"%3E%3Crect fill="%23ddd" width="300" height="350"/%3E%3Ctext x="50%25" y="50%25" font-size="20" text-anchor="middle" fill="%23666"%3EImage not found%3C/text%3E%3C/svg%3E';
                    };
                    card.appendChild(img);
                }

                const titleDiv = document.createElement('div');
                titleDiv.className = 'comic-title';
                titleDiv.textContent = comic.title;

                card.appendChild(titleDiv);
                comicsList.appendChild(card);
            });
        }

        // Get comics for a folder path
        async function getComicsForFolder(folderPath) {
            try {
                // Properly encode the path - encode each part separately to preserve slashes
                const pathParts = folderPath.split('/').map(part => encodeURIComponent(part));
                const encodedPath = pathParts.join('/');

                const url = `${GITHUB_API_BASE}/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/Website/${encodedPath}`;
                const response = await fetch(url);

                if (!response.ok) {
                    console.error('Failed to load comics from GitHub for', folderPath);
                    return [];
                }

                const items = await response.json();

                // Filter to only image files and PDFs, exclude Background.JPG
                const imageExtensions = ['.jpeg', '.jpg', '.png', '.gif', '.heic'];
                const validFiles = items.filter(item => {
                    if (item.type !== 'file') return false;
                    if (item.name === 'Background.JPG') return false;
                    const ext = item.name.toLowerCase().substring(item.name.lastIndexOf('.'));
                    return imageExtensions.includes(ext) || ext === '.pdf';
                });

                // Convert to comic objects
                const comics = validFiles.map(file => {
                    const ext = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
                    return {
                        title: file.name.replace(/\.(jpeg|jpg|png|gif|heic|pdf)$/i, ''),
                        path: `Website/${folderPath}/${file.name}`,
                        isPdf: ext === '.pdf'
                    };
                });

                console.log(`Loaded ${comics.length} comics from ${folderPath}:`, comics);
                return comics;

            } catch (error) {
                console.error('Error loading comics from GitHub:', error);
                return [];
            }
        }

        // Go back to series view
        function goBack() {
            document.getElementById('seriesView').classList.remove('hidden');
            document.getElementById('comicsView').classList.add('hidden');
            document.getElementById('breadcrumb').classList.add('hidden');
            document.getElementById('subTabContainer').classList.add('hidden');
            currentSeries = null;

            // Reset to default Dan Comics branding
            document.getElementById('headerTitle').textContent = 'DAN COMICS';
            document.getElementById('headerSubtitle').textContent = 'Created by Evan from San Diego';
            document.getElementById('aboutTitle').textContent = 'About Evan';
            document.getElementById('aboutText').innerHTML = `
                Meet Evan, an 11-year-old comic artist from San Diego, California!
                Evan creates hilarious and imaginative adventures featuring Dan and friends.
                From epic battles to everyday funnies, each comic is bursting with creativity and humor.
                Dive into the wild world of The Dan Comics and discover what happens when imagination knows no bounds!
            `;

            // Clear URL
            window.location.hash = '';
        }

        // Check if device is mobile
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Open lightbox
        function openLightbox(index) {
            currentComicIndex = index;
            const comic = currentComics[index];

            // On mobile devices, open PDFs in a new tab instead of iframe
            if (comic.isPdf && isMobileDevice()) {
                window.open(comic.path, '_blank');
                return;
            }

            const lightboxImg = document.getElementById('lightboxImg');
            const lightboxPdf = document.getElementById('lightboxPdf');

            if (comic.isPdf) {
                // Show PDF in iframe (desktop only)
                lightboxImg.classList.add('hidden');
                lightboxPdf.classList.remove('hidden');
                lightboxPdf.src = comic.path;
            } else {
                // Show image
                lightboxPdf.classList.add('hidden');
                lightboxImg.classList.remove('hidden');
                lightboxImg.src = comic.path;
            }

            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close lightbox
        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = 'auto';

            // Clear sources
            document.getElementById('lightboxImg').src = '';
            document.getElementById('lightboxPdf').src = '';
        }

        // Navigate between comics in lightbox
        function navigateComic(direction) {
            currentComicIndex += direction;

            if (currentComicIndex < 0) {
                currentComicIndex = currentComics.length - 1;
            } else if (currentComicIndex >= currentComics.length) {
                currentComicIndex = 0;
            }

            const comic = currentComics[currentComicIndex];

            // On mobile, skip PDFs since they open in new tab
            if (comic.isPdf && isMobileDevice()) {
                navigateComic(direction); // Skip to next/previous
                return;
            }

            const lightboxImg = document.getElementById('lightboxImg');
            const lightboxPdf = document.getElementById('lightboxPdf');

            if (comic.isPdf) {
                lightboxImg.classList.add('hidden');
                lightboxPdf.classList.remove('hidden');
                lightboxPdf.src = comic.path;
            } else {
                lightboxPdf.classList.add('hidden');
                lightboxImg.classList.remove('hidden');
                lightboxImg.src = comic.path;
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('lightbox').classList.contains('active')) {
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowLeft') {
                    navigateComic(-1);
                } else if (e.key === 'ArrowRight') {
                    navigateComic(1);
                }
            }
        });

        // Close lightbox when clicking outside content
        document.getElementById('lightbox').addEventListener('click', (e) => {
            if (e.target.id === 'lightbox') {
                closeLightbox();
            }
        });

        // Initialize on page load
        init();
    </script>
</body>
</html>
