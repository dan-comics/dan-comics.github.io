<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dan Comics - By Evan</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Neue', 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: url('Website/Webbackground.jpg') center center;
            background-size: cover;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            min-height: 200px;
        }

        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.1);
            z-index: 0;
        }

        .header h1 {
            font-family: 'Bangers', cursive;
            font-size: 4em;
            color: #fff;
            text-shadow: 4px 4px 0 #000,
                         6px 6px 10px rgba(0,0,0,0.8),
                         -2px -2px 0 #FF1493,
                         2px -2px 0 #00CED1,
                         -2px 2px 0 #FFD700;
            letter-spacing: 3px;
            position: relative;
            z-index: 1;
            animation: bounce 2s infinite;
        }

        .subtitle {
            font-size: 1.5em;
            color: #fff;
            margin-top: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8),
                         0 0 10px rgba(0,0,0,0.6);
            position: relative;
            z-index: 1;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .nav-breadcrumb {
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            text-align: center;
            font-size: 1.1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .nav-breadcrumb button {
            background: #FF6347;
            color: white;
            border: 3px solid #000;
            padding: 10px 20px;
            font-family: 'Bangers', cursive;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.2s;
        }

        .nav-breadcrumb button:hover {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #000;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .series-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 40px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .comics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .series-card {
            background: white;
            border: 4px solid #000;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
            position: relative;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .series-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 7px 7px 0 rgba(0,0,0,0.4);
        }

        .series-card:active {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0 rgba(0,0,0,0.3);
        }

        .series-button-content {
            text-align: center;
            width: 100%;
        }

        .series-card .series-icon {
            font-size: 50px;
            display: block;
            margin-bottom: 10px;
        }

        .series-card h3 {
            font-family: 'Bangers', cursive;
            font-size: 1.5em;
            color: #333;
            text-shadow: 2px 2px 0 rgba(255,215,0,0.5);
            margin: 0;
        }

        .comic-card {
            background: white;
            border: 5px solid #000;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.3);
            position: relative;
        }

        .comic-card:hover {
            transform: translate(-4px, -4px) rotate(-2deg);
            box-shadow: 12px 12px 0 rgba(0,0,0,0.4);
        }

        .comic-card img {
            width: 100%;
            height: 350px;
            object-fit: cover;
            display: block;
            border-bottom: 3px solid #000;
        }

        .comic-title {
            padding: 15px;
            background: #FFE082;
            font-weight: bold;
            text-align: center;
            color: #333;
            font-size: 1.1em;
        }

        .comic-views {
            padding: 8px 15px;
            background: #FFD700;
            text-align: center;
            font-size: 0.9em;
            color: #333;
            border-top: 2px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .comic-views::before {
            content: "üëÅÔ∏è";
            font-size: 1.1em;
        }

        .about-section {
            background: white;
            border: 5px solid #000;
            border-radius: 15px;
            padding: 40px;
            margin: 40px auto;
            max-width: 800px;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.3);
        }

        .about-section h2 {
            font-family: 'Bangers', cursive;
            font-size: 2.5em;
            color: #FF6347;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #FFD700;
        }

        .about-section p {
            font-size: 1.3em;
            line-height: 1.8;
            color: #333;
            text-align: center;
        }

        .footer {
            background: #333;
            color: #FFD700;
            text-align: center;
            padding: 30px 20px;
            font-size: 1.2em;
            font-family: 'Bangers', cursive;
            letter-spacing: 2px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.3);
        }

        /* Lightbox Styles */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            animation: zoomIn 0.3s;
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .lightbox img {
            max-width: 100%;
            max-height: 90vh;
            border: 5px solid #FFD700;
            box-shadow: 0 0 50px rgba(255,215,0,0.5);
        }

        .lightbox-close {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #FF6347;
            color: white;
            border: 3px solid #000;
            padding: 10px 20px;
            font-family: 'Bangers', cursive;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 3px 3px 0 #000;
            z-index: 1001;
        }

        .lightbox-nav {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,215,0,0.9);
            border: 3px solid #000;
            padding: 15px 12px;
            font-size: 1.8em;
            cursor: pointer;
            border-radius: 50%;
            font-family: 'Bangers', cursive;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.2s;
            z-index: 1001;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-nav:hover {
            background: #FFD700;
            transform: translateY(-50%) scale(1.15);
        }

        .lightbox-prev {
            left: 20px;
        }

        .lightbox-next {
            right: 20px;
        }

        .hidden {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                padding: 30px 15px;
            }

            .comics-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 20px;
            }

            .comic-card img {
                height: 300px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }

            .subtitle {
                font-size: 1.2em;
            }

            .series-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 0 10px;
            }

            .series-card {
                min-height: 100px;
                padding: 15px;
            }

            .series-card .series-icon {
                font-size: 40px;
                margin-bottom: 8px;
            }

            .series-card h3 {
                font-size: 1.3em;
            }

            .comics-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .comic-card img {
                height: auto;
                min-height: 250px;
            }

            .about-section {
                padding: 25px;
                margin: 30px 10px;
            }

            .about-section h2 {
                font-size: 2em;
            }

            .about-section p {
                font-size: 1.1em;
            }

            .lightbox-close {
                top: 10px;
                right: 10px;
                font-size: 1.2em;
                padding: 8px 15px;
                position: fixed;
            }

            .lightbox-nav {
                padding: 10px 8px;
                font-size: 1.4em;
                width: 45px;
                height: 45px;
            }

            .lightbox-prev {
                left: 10px;
            }

            .lightbox-next {
                right: 10px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 2em;
                letter-spacing: 1px;
            }

            .subtitle {
                font-size: 1em;
            }

            .series-card h3 {
                font-size: 1.1em;
            }

            .series-card .series-icon {
                font-size: 35px;
            }

            .nav-breadcrumb button {
                padding: 8px 15px;
                font-size: 1em;
            }

            .lightbox-content {
                max-width: 95%;
            }

            .footer {
                font-size: 1em;
                padding: 20px 15px;
            }
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 2em;
            color: white;
            font-family: 'Bangers', cursive;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>DAN COMICS</h1>
        <div class="subtitle">Created by Evan from San Diego</div>
    </div>

    <div class="nav-breadcrumb hidden" id="breadcrumb">
        <button onclick="goBack()">‚Üê Back to Series</button>
    </div>

    <div class="container" id="mainContent">
        <div id="seriesView" class="series-grid">
            <!-- Series will be loaded here -->
        </div>

        <div id="comicsView" class="hidden">
            <div class="comics-grid" id="comicsList">
                <!-- Comics will be loaded here -->
            </div>
        </div>

        <div class="about-section">
            <h2>About Evan</h2>
            <p>
                Meet Evan, an 11-year-old comic artist from San Diego, California!
                Evan creates hilarious and imaginative adventures featuring Dan and friends.
                From epic battles to everyday funnies, each comic is bursting with creativity and humor.
                Dive into the wild world of The Dan Comics and discover what happens when imagination knows no bounds!
            </p>
        </div>
    </div>

    <div class="footer">
        Created in San Diego, CA ‚òÄÔ∏è<br>
        ¬© 2026 Dan (creator of Dan Comic). All rights reserved.
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">‚úï Close</button>
        <button class="lightbox-nav lightbox-prev" onclick="navigateComic(-1)">‚Üê</button>
        <button class="lightbox-nav lightbox-next" onclick="navigateComic(1)">‚Üí</button>
        <div class="lightbox-content">
            <img id="lightboxImg" src="" alt="Comic">
        </div>
    </div>

    <script>
        // Comic series data structure - will be populated dynamically
        let comicSeries = [];

        // GitHub repository information
        const GITHUB_REPO_OWNER = 'dan-comics';
        const GITHUB_REPO_NAME = 'dan-comics.github.io';
        const GITHUB_API_BASE = 'https://api.github.com';

        // Series icons and colors mapping
        // To customize a new series, add it here with format: 'Folder Name': { icon: 'emoji', color: '#HEX' }
        // If a folder is not listed here, it will get a default book icon and random color
        const seriesConfig = {
            'Origional Dan': { icon: '‚≠ê', color: '#FF6B6B' },
            'Dan Funnies': { icon: 'üòÇ', color: '#4ECDC4' },
            'Cheez Dame': { icon: 'üßÄ', color: '#FFD93D' },
            'Dan Music': { icon: 'üéµ', color: '#95E1D3' },
            'Dan Ice cream': { icon: 'üç¶', color: '#F38181' },
            'Dan Shorts': { icon: 'üé¨', color: '#AA96DA' },
            'Dan Science': { icon: 'üî¨', color: '#FCBAD3' },
            'Dan Charaters': { icon: 'üë•', color: '#FFA07A' },
            'More Series Here': { icon: '‚ú®', color: '#A8E6CF' }
        };

        let currentSeries = null;
        let currentComics = [];
        let currentComicIndex = 0;

        // Global view tracking system
        // Using a simple approach with a reliable counter service
        const COUNTER_API_BASE = 'https://api.countapi.xyz';
        const COUNTER_NAMESPACE = 'dancomics';

        function getComicKey(series, title) {
            // Create a unique key for each comic
            return `${series}_${title}`.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
        }

        async function getViewCount(series, title) {
            const key = getComicKey(series, title);
            const url = `${COUNTER_API_BASE}/get/${COUNTER_NAMESPACE}/${key}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    console.log('Counter does not exist yet, will be created on first view');
                    return 0;
                }
                const data = await response.json();
                console.log('Fetched view count for', key, ':', data);
                return data.value || 0;
            } catch (error) {
                console.error('Error fetching view count:', error);
                return 0;
            }
        }

        async function incrementView(series, title) {
            const key = getComicKey(series, title);
            const url = `${COUNTER_API_BASE}/hit/${COUNTER_NAMESPACE}/${key}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                console.log('Incremented view count for', key, ':', data);
                return data.value || 1;
            } catch (error) {
                console.error('Error incrementing view count:', error);
                return 1;
            }
        }

        // Initialize the page
        async function init() {
            await loadSeriesFromGitHub();
            loadSeries();
        }

        // Load series folders dynamically from GitHub
        async function loadSeriesFromGitHub() {
            try {
                const url = `${GITHUB_API_BASE}/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/Website`;
                const response = await fetch(url);

                if (!response.ok) {
                    console.error('Failed to load from GitHub, using fallback');
                    loadFallbackSeries();
                    return;
                }

                const items = await response.json();

                // Filter to only directories (folders)
                const folders = items.filter(item => item.type === 'dir');

                // Create series array from discovered folders
                comicSeries = folders.map(folder => {
                    const folderName = folder.name;
                    const config = seriesConfig[folderName] || {
                        icon: 'üìö',
                        color: getRandomColor()
                    };

                    return {
                        name: folderName,
                        folder: folderName,
                        color: config.color,
                        icon: config.icon
                    };
                });

                console.log('Loaded series from GitHub:', comicSeries);
            } catch (error) {
                console.error('Error loading series from GitHub:', error);
                loadFallbackSeries();
            }
        }

        // Fallback series if GitHub API fails
        function loadFallbackSeries() {
            comicSeries = [
                { name: "Origional Dan", folder: "Origional Dan", color: "#FF6B6B", icon: "‚≠ê" },
                { name: "Dan Funnies", folder: "Dan Funnies", color: "#4ECDC4", icon: "üòÇ" },
                { name: "Cheez Dame", folder: "Cheez Dame", color: "#FFD93D", icon: "üßÄ" },
                { name: "Dan Music", folder: "Dan Music", color: "#95E1D3", icon: "üéµ" },
                { name: "Dan Ice cream", folder: "Dan Ice cream", color: "#F38181", icon: "üç¶" },
                { name: "Dan Shorts", folder: "Dan Shorts", color: "#AA96DA", icon: "üé¨" },
                { name: "Dan Science", folder: "Dan Science", color: "#FCBAD3", icon: "üî¨" },
                { name: "Dan Charaters", folder: "Dan Charaters", color: "#FFA07A", icon: "üë•" },
                { name: "More Series Here", folder: "More Series Here", color: "#A8E6CF", icon: "‚ú®" }
            ];
        }

        // Generate a random color for new series
        function getRandomColor() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#95E1D3', '#F38181', '#AA96DA', '#FCBAD3', '#A8E6CF'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Load all series
        function loadSeries() {
            const seriesView = document.getElementById('seriesView');
            seriesView.innerHTML = '';

            comicSeries.forEach((series, index) => {
                const card = document.createElement('div');
                card.className = 'series-card';
                card.style.background = series.color;
                card.onclick = () => loadComics(series);

                card.innerHTML = `
                    <div class="series-button-content">
                        <span class="series-icon">${series.icon}</span>
                        <h3>${series.name}</h3>
                    </div>
                `;

                seriesView.appendChild(card);
            });
        }

        // Load comics for a specific series
        async function loadComics(series) {
            currentSeries = series;
            document.getElementById('seriesView').classList.add('hidden');
            document.getElementById('comicsView').classList.remove('hidden');
            document.getElementById('breadcrumb').classList.remove('hidden');

            const comicsList = document.getElementById('comicsList');
            comicsList.innerHTML = '<div class="loading">Loading comics...</div>';

            // Simulate loading comics from the folder
            // In a real implementation, you would fetch this data from the server
            const comics = await getComicsForSeries(series.folder);
            currentComics = comics;

            comicsList.innerHTML = '';

            if (comics.length === 0) {
                comicsList.innerHTML = '<div class="loading">No comics found in this series yet!</div>';
                return;
            }

            comics.forEach((comic, index) => {
                const card = document.createElement('div');
                card.className = 'comic-card';
                card.onclick = () => openLightbox(index);

                const img = document.createElement('img');
                img.src = comic.path;
                img.alt = comic.title;
                img.loading = 'lazy';
                img.onerror = function() {
                    this.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="350"%3E%3Crect fill="%23ddd" width="300" height="350"/%3E%3Ctext x="50%25" y="50%25" font-size="20" text-anchor="middle" fill="%23666"%3EImage not found%3C/text%3E%3C/svg%3E';
                };

                const titleDiv = document.createElement('div');
                titleDiv.className = 'comic-title';
                titleDiv.textContent = comic.title;

                // Add view counter (loading state initially)
                const viewsDiv = document.createElement('div');
                viewsDiv.className = 'comic-views';
                viewsDiv.id = `views-${index}`;
                viewsDiv.textContent = 'Loading...';

                card.appendChild(img);
                card.appendChild(titleDiv);
                card.appendChild(viewsDiv);
                comicsList.appendChild(card);

                // Load view count asynchronously
                getViewCount(currentSeries.name, comic.title).then(viewCount => {
                    viewsDiv.textContent = `${viewCount} views`;
                }).catch(err => {
                    console.error('Error loading view count:', err);
                    viewsDiv.textContent = '0 views';
                });
            });
        }

        // Get comics for a series - dynamically from GitHub
        async function getComicsForSeries(folder) {
            try {
                const url = `${GITHUB_API_BASE}/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/Website/${encodeURIComponent(folder)}`;
                const response = await fetch(url);

                if (!response.ok) {
                    console.error('Failed to load comics from GitHub for', folder);
                    return [];
                }

                const items = await response.json();

                // Filter to only image files (jpeg, jpg, png, gif, pdf)
                const imageExtensions = ['.jpeg', '.jpg', '.png', '.gif', '.pdf'];
                const imageFiles = items.filter(item => {
                    if (item.type !== 'file') return false;
                    const ext = item.name.toLowerCase().substring(item.name.lastIndexOf('.'));
                    return imageExtensions.includes(ext);
                });

                // Convert to comic objects
                const comics = imageFiles.map(file => ({
                    title: file.name.replace(/\.(jpeg|jpg|png|gif|pdf)$/i, ''),
                    path: `Website/${folder}/${file.name}`
                }));

                console.log(`Loaded ${comics.length} comics from ${folder}:`, comics);
                return comics;

            } catch (error) {
                console.error('Error loading comics from GitHub:', error);
                return [];
            }
        }

        // Go back to series view
        function goBack() {
            document.getElementById('seriesView').classList.remove('hidden');
            document.getElementById('comicsView').classList.add('hidden');
            document.getElementById('breadcrumb').classList.add('hidden');
            currentSeries = null;
        }

        // Open lightbox
        function openLightbox(index) {
            currentComicIndex = index;
            const comic = currentComics[index];

            // Increment view count (async)
            incrementView(currentSeries.name, comic.title).then(newViewCount => {
                // Update the view counter display on the card
                const viewsElement = document.getElementById(`views-${index}`);
                if (viewsElement) {
                    viewsElement.textContent = `${newViewCount} views`;
                }
            }).catch(err => {
                console.error('Error incrementing view count:', err);
            });

            document.getElementById('lightboxImg').src = comic.path;
            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close lightbox
        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Navigate between comics in lightbox
        function navigateComic(direction) {
            currentComicIndex += direction;

            if (currentComicIndex < 0) {
                currentComicIndex = currentComics.length - 1;
            } else if (currentComicIndex >= currentComics.length) {
                currentComicIndex = 0;
            }

            const comic = currentComics[currentComicIndex];
            document.getElementById('lightboxImg').src = comic.path;
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('lightbox').classList.contains('active')) {
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowLeft') {
                    navigateComic(-1);
                } else if (e.key === 'ArrowRight') {
                    navigateComic(1);
                }
            }
        });

        // Close lightbox when clicking outside image
        document.getElementById('lightbox').addEventListener('click', (e) => {
            if (e.target.id === 'lightbox') {
                closeLightbox();
            }
        });

        // Utility function to adjust color brightness
        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 +
                (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }

        // Initialize on page load
        init();
    </script>
</body>
</html>
